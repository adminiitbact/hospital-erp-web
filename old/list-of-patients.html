<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Sat Apr 11 2020 10:40:25 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5e91459436c30be9e5d9f765" data-wf-site="5e89e56bbebe7d2e8604de36">

<head>
    <meta charset="utf-8">
    <title>List of Patients</title>
    <meta content="List of Patients" property="og:title">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    <link href="css/normalize.css" rel="stylesheet" type="text/css">
    <link href="css/webflow.css" rel="stylesheet" type="text/css">
    <link href="css/safeco.webflow.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">
        WebFont.load({
            google: {
                families: ["Inter:100,200,300,regular,500,600,700,800,900", "Roboto:100,100italic,300,300italic,regular,italic,500,500italic,700,700italic,900,900italic", "Muli:200,300,regular,500,600,700,800,900,200italic,300italic,italic,500italic,600italic,700italic,800italic,900italic"]
            }
        });
    </script>
    <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
    <script type="text/javascript">
        ! function(o, c) {
            var n = c.documentElement,
                t = " w-mod-";
            n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
        }(window, document);
    </script>
    <link href="images/cov2_favicon.png" rel="shortcut icon" type="image/x-icon">
    <link href="images/webclip.png" rel="apple-touch-icon">
    <style>
         ::-webkit-scrollbar {
            width: 12px;
            /* Controls the overall width of the scrollbar */
            padding: 2.5px;
            /* Controls the padding of the Scrollbar */
        }
        /* Track - This is the part that contains the bit you click and drag */
        
         ::-webkit-scrollbar-track {
            background: transparent;
            /* Sets the background to transparent, change to a Hex or RGB value if you would like */
        }
        /* Handle - This is the bit you actually click and drag */
        
         ::-webkit-scrollbar-thumb {
            background: #828592;
            /* Change the Hex value to change the scroll handle */
            border-radius: 6px;
            /* Change the "px" to adjust the scroll handle's border radius*/
            border: white 1px solid/* This controls whether the scroll handle has a border, right now it's set to a White, 1px Solid border, you can change these settings or remove this line altogether if you don't want a border */
        }
        
        .SCROLLABLE-Section-4 {
            overflow-x: hidden;
        }
    </style>
</head>

<body class="body">
    <div class="div-block-4 status-form">
        <div class="div-block status-form">
            <div class="columns-4 w-row">
                <div class="w-col w-col-2">
                    <div class="div-block-2 status-form">
                        <div class="section">
                            <div class="div-block-26">
                                <div class="logo-div w-inline-block"></div>
                            </div>
                        </div>
                    </div>
                    <div class="section">
                        <a href="/status-form" class="logout-button  w-inline-block">
                            <div class="">Home</div>
                        </a>
                        <a href="patient-overview.html" class="logout-button  w-inline-block">
                            <div class="">Add New Patient +</div>
                        </a>
                        <a href="referred-patient-list" class="logout-button  w-inline-block">
                            <div class="">referred patients</div>
                        </a>
                        <a href="patient-list" class="logout-button  w-inline-block">
                            <div class="">Patients LIST</div>
                        </a>
                        <a href="profile-form" class="logout-button  w-inline-block">
                            <div class="">Edit Profile</div>
                        </a>
                        <a href="#" id="logout" class="logout-button w-inline-block">
                            <div>Logout</div>
                        </a>
                    </div>
                </div>
                <div class="column w-col w-col-10">
                    <div class="div-block-44">
                        <div class="hospital-profile-header-div _1">
                            <h1 class="heading-2 _3">Patient List</h1>
                            <div class="div-block-53">
                                <form id='search_form' class="search w-form">
                                    <input type="text" class="search-input w-input" autofocus="true" maxlength="256" name="search_query" placeholder="Search Patient Name" id="search_query">
                                    <input type="submit" value="Search" class="button-2 search w-button">
                                    <a href="#" class="button-3 w-button">CLEAR</a>
                                </form>
                            </div>
                        </div>
                        <div class="div-block-36 _1 _2">
                            <div class="section-8 patient-list table">
                                <div class="columns-6 w-row table-header">
                                    <div class="w-col w-col-2 header__item">
                                        <a href="#" class="link-block-3 _1 w-inline-block" id="l_patient_id">
                                            <div class="legends">Patient Id</div>
                                        </a>
                                    </div>
                                    <div class="w-col w-col-3 header__item">
                                        <a href="#" class="link-block-3 w-inline-block" id="l_patient_name">
                                            <div class="legends">Name of patient</div>
                                        </a>
                                    </div>
                                    <div class="w-col w-col-2 header__item">
                                        <a href="#" class="link-block-3 w-inline-block" id="l_ward">
                                            <div class="legends">ward</div>
                                        </a>
                                    </div>
                                    <div class="w-col w-col-2 header__item">
                                        <a href="#" class="link-block-3 w-inline-block" id="l_severity">
                                            <div class="legends">severity</div>
                                        </a>
                                    </div>
                                    <div class="w-col w-col-2 header__item">
                                        <a href="#" class="link-block-3 w-inline-block" id="l_covid_test">
                                            <div class="legends">Covid-19 Test</div>
                                        </a>
                                    </div>
                                    <div class="w-col w-col-1">
                                        <a href="#" class="link-block-3 _1 w-inline-block">
                                            <div class="legends">Update</div>
                                        </a>
                                    </div>
                                </div>
                                <div id="patient_list" class="patient-list-div table-content">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.4.1.min.220afd743d.js?site=5e89e56bbebe7d2e8604de36" type="text/javascript" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="js/globalconf.js" type="text/javascript"></script>
    <script src="js/config.js" type="text/javascript"></script>
    <script src="js/webflow.js" type="text/javascript"></script>
    <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-firestore.js"></script>
    <script>
        // Your web app's Firebase configuration
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
    <script>
        $(document).ready(function() {
            patients = null;
            var dataAuthToken = {
                "authToken": window.localStorage.getItem("authToken")
            };
            var headers = {
                "Content-Type": "application/json"
            };
            $("#logout").click(function() {
                firebase.auth().signOut().then(function() {
                    // Sign-out successful.
                    window.localStorage.removeItem("authToken");
                    window.location.href = "index.html";
                }).catch(function(error) {
                    alert("Error in Sign-out." + error);
                });
            });
            if (window.localStorage.getItem("authToken") == null) {
                $("#logout").click(); //logout if authToken is not available
                return;
            }

            var userProfileURL = apiURL + "hospital/user/profile";
            $.ajax({
                type: "POST",
                url: userProfileURL,
                data: JSON.stringify(dataAuthToken),
                headers: headers,
                success: function(res) {
                    var userData = res.data;
                    var userProfile = userData.profile;
                    var facilityId = userProfile.facilityId;
                    fetchPatients(facilityId);
                }, //userProfile success function ends
                error: function(jqXHR, textStatus, error) {
                    alert("user profile error: " + error);
                },
            }); //ajax userProfile 
            function fetchPatients(facilityId) {
                fetchPatientsURL = apiURL + "facilities/" + facilityId + "/patients/get";
                data = {
                    "authToken": window.localStorage.getItem("authToken"),
                    "wardAlloted": true,
                }
                $.ajax({
                    type: "POST",
                    url: fetchPatientsURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        log("Patient Fetch Response: ", res)
                        patients = res.data.list;
                        populatePatientList(patients);
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("fetch patient error: " + error);
                    },
                }); //fetch patients ajax
            }

            function populatePatientList(patients) {
                listHTML = "";
                patients.forEach(function(patient, index) {
                    name = patient.patientName;
                    ward = patient.wardName == null ? "not alloted" : patient.wardName;
                    severity = severityMap[patient.severity];
                    test_status = testStatusMap[patient.testStatus];
                    patientId = patient.patientId;
                    patientHospitalId = patient.patientHospitalId;
                    test_status_class = "";
                    patient["index"] = index + 1;
                    switch (patient.testStatus) {
                        case "POSITIVE":
                            test_status = "POSITIVE";
                            test_status_class = "positive";
                            break;
                        case "NEGATIVE":
                            test_status = "NEGATIVE";
                            test_status_class = "negative";
                            break;
                        case "PENDING_TEST":
                            test_status = "TEST PENDING";
                            break;
                        case "PENDING_RESULT":
                            test_status = "TEST RESULT PENDING";
                            break;
                    }
                    row = '<div class="columns-7 w-row table-row">\
                            <div class="table-data w-col w-col-2">\
                                <div class="pd-list">' + patientHospitalId + '</div>\
                            </div>\
                            <div class="table-data w-col w-col-3">\
                                <div class="pd-list">' + name + '</div>\
                            </div>\
                            <div class="table-data w-col w-col-2">\
                                <div class="pd-list">' + ward + '</div>\
                            </div>\
                            <div class="table-data w-col w-col-2">\
                                <div class="pd-list">' + severity + '</div>\
                            </div>\
                            <div class="table-data w-col w-col-2">\
                                <div class="pd-list ' + test_status_class + '">' + test_status + '</div>\
                            </div>\
                            <div class="w-col w-col-1"><a href="patient-overview.html?patient_id=' + patientId + '" class="button-2 w-button">update</a></div>\
                        </div>'
                    listHTML += row;
                }); //foreach
                $("#patient_list").html(listHTML);
            } //populatePatient
            $("#search_form").submit(function(e) {
                searchAndUpdatePatientList();
                e.preventDefault();
            }); //search_form submit
            $("#search_query").keyup(function(e) {
                searchAndUpdatePatientList();
            });

            function searchAndUpdatePatientList() {
                search_query = $("#search_query").val();
                newPatientList = [];
                patients.forEach(function(patient, index) {
                    if (patient.patientName.toLowerCase().includes(search_query.toLowerCase())) {
                        newPatientList.push(patient);
                    }
                }); //forEach
                populatePatientList(newPatientList);
            }


        });
    </script>
    <script>
        var properties = [
            "l_patient_id",
            "l_patient_name",
            "l_ward",
            "l_severity",
            "l_covid_test",
        ];

        $.each(properties, function(i, val) {

            var orderClass = '';

            $("#" + val).click(function(e) {
                e.preventDefault();
                $('.filter__link.filter__link--active').not(this).removeClass('filter__link--active');
                $(this).toggleClass('filter__link--active');
                $('.filter__link').removeClass('asc desc');

                if (orderClass == 'desc' || orderClass == '') {
                    $(this).addClass('asc');
                    orderClass = 'asc';
                } else {
                    $(this).addClass('desc');
                    orderClass = 'desc';
                }

                var parent = $(this).closest('.header__item');
                var index = $(".header__item").index(parent);
                var $table = $('.table-content');
                var rows = $table.find('.table-row').get();
                var isSelected = $(this).hasClass('filter__link--active');
                var isNumber = $(this).hasClass('filter__link--number');

                rows.sort(function(a, b) {

                    var x = $(a).find('.table-data').eq(index).text();
                    var y = $(b).find('.table-data').eq(index).text();

                    if (isNumber == true) {

                        if (isSelected) {
                            return x - y;
                        } else {
                            return y - x;
                        }

                    } else {

                        if (isSelected) {
                            if (x < y) return -1;
                            if (x > y) return 1;
                            return 0;
                        } else {
                            if (x > y) return -1;
                            if (x < y) return 1;
                            return 0;
                        }
                    }
                });

                $.each(rows, function(index, row) {
                    $table.append(row);
                });

                return false;
            });

        });
    </script>
</body>

</html>